"! Automatic creation of Warehouse Products
"! <p>This report is being executed by a job ZIOT_WHSPRD_CREATION and creates warehouse products from ECC products.
"! These products are being sent by the ECC to EWM via IDOCs. After the EWM received these MATMAS-IDOCs a method
"! is being triggered in the enhancement ZIOT_EI_IDOC_INPUT_MATMAS01_E which creates the job if it hasn't been
"! already scheduled or released.</p>
CLASS ziot_cl_whsprd_creation DEFINITION
  PUBLIC
  FINAL
  CREATE PRIVATE .

  PUBLIC SECTION.
    CONSTANTS: mc_job_name  TYPE btcjob   VALUE 'ZIOT_WHSPRD_CREATION',
               mc_rep_name  TYPE btcrep   VALUE 'ZIOT_R_WHSPRD_CREATION',
               mc_fm_name   TYPE progname VALUE 'ZIOT_FM_WHSPRD_CREATION',
               mc_task_name TYPE progname VALUE 'ZIOT_WHSPRD_CREATION'.
CLASS-METHODS CLASS-METHODS CLASS-METHODS CLASS-METHODS CLASS-METHODS CLASS-METHODS CLASS-METHODS CLASS-METHODS CLASS-METHODS CLASS-METHODS 
    CLASS-METHODS: 
      execute
        IMPORTING
          iv_lgnum    TYPE /scwm/lgnum DEFAULT ziot_constants=>lgnum
          iv_entitled TYPE /scwm/de_entitled DEFAULT ziot_constants=>entitled
        RAISING
          zcx_cp_not_readable
          zcx_plc_not_determinable.
      idoc_input_matmas01_e
        IMPORTING
          iv_lgnum    TYPE /scwm/lgnum DEFAULT ziot_constants=>lgnum
          iv_entitled TYPE /scwm/de_entitled DEFAULT ziot_constants=>entitled
        RAISING
          zcx_cp_not_readable
          zcx_plc_not_determinable.
      idoc_input_matmas02_e.
      idoc_input_matmas03_e
        IMPORTING
          iv_lgnum    TYPE /scwm/lgnum DEFAULT ziot_constants=>lgnum
          iv_entitled TYPE /scwm/de_entitled DEFAULT ziot_constants=>entitled
        RAISING
          zcx_cp_not_readable
          zcx_plc_not_determinable.
    CLASS-METHODS create_job.
    CLASS-METHODS 
    det_relevant_products
      RETURNING
        VALUE(rt_products) TYPE /sapapo/matkey_out_tab.
    CLASS-METHODS conv_apo_matkey_to_whsprod
      IMPORTING
        !it_products       TYPE /sapapo/matkey_out_tab
      RETURNING
        VALUE(rt_products) TYPE /scwm/tt_material_lgnum_maint.
    CLASS-METHODS create_whs_products
      IMPORTING
        !it_products TYPE /scwm/tt_material_lgnum_maint.
    CLASS-METHODS: lock_products
      IMPORTING
        !it_products TYPE /scwm/tt_material_lgnum_maint.
    dequeue_all
      RAISING
        zcx_cp_not_readable
        zcx_plc_not_determinable.CLASS-METHODS CLASS-METHODS CLASS-METHODS CLASS-METHODS CLASS-METHODS CLASS-METHODS CLASS-METHODS CLASS-METHODS CLASS-METHODS CLASS-METHODS 
    CLASS-METHODS: 
      execute
        IMPORTING
          iv_lgnum    TYPE /scwm/lgnum DEFAULT ziot_constants=>lgnum
          iv_entitled TYPE /scwm/de_entitled DEFAULT ziot_constants=>entitled
        RAISING
          zcx_cp_not_readable
          zcx_plc_not_determinable.
      idoc_input_matmas01_e
        IMPORTING
          iv_lgnum    TYPE /scwm/lgnum DEFAULT ziot_constants=>lgnum
          iv_entitled TYPE /scwm/de_entitled DEFAULT ziot_constants=>entitled
        RAISING
          zcx_cp_not_readable
          zcx_plc_not_determinable.
      idoc_input_matmas02_e.
      idoc_input_matmas03_e
        IMPORTING
          iv_lgnum    TYPE /scwm/lgnum DEFAULT ziot_constants=>lgnum
          iv_entitled TYPE /scwm/de_entitled DEFAULT ziot_constants=>entitled
        RAISING
          zcx_cp_not_readable
          zcx_plc_not_determinable.
    CLASS-METHODS create_job.
    CLASS-METHODS 
    det_relevant_products
      RETURNING
        VALUE(rt_products) TYPE /sapapo/matkey_out_tab.
    CLASS-METHODS conv_apo_matkey_to_whsprod
      IMPORTING
        !it_products       TYPE /sapapo/matkey_out_tab
      RETURNING
        VALUE(rt_products) TYPE /scwm/tt_material_lgnum_maint.
    CLASS-METHODS create_whs_products
      IMPORTING
        !it_products TYPE /scwm/tt_material_lgnum_maint.
    CLASS-METHODS: lock_products
      IMPORTING
        !it_products TYPE /scwm/tt_material_lgnum_maint.
    dequeue_all
      RAISING
        zcx_cp_not_readable
        zcx_plc_not_determinable.CLASS-METHODS CLASS-METHODS CLASS-METHODS CLASS-METHODS CLASS-METHODS CLASS-METHODS CLASS-METHODS CLASS-METHODS CLASS-METHODS CLASS-METHODS 
    CLASS-METHODS: 
      execute
        IMPORTING
          iv_lgnum    TYPE /scwm/lgnum DEFAULT ziot_constants=>lgnum
          iv_entitled TYPE /scwm/de_entitled DEFAULT ziot_constants=>entitled
        RAISING
          zcx_cp_not_readable
          zcx_plc_not_determinable.
      idoc_input_matmas01_e
        IMPORTING
          iv_lgnum    TYPE /scwm/lgnum DEFAULT ziot_constants=>lgnum
          iv_entitled TYPE /scwm/de_entitled DEFAULT ziot_constants=>entitled
        RAISING
          zcx_cp_not_readable
          zcx_plc_not_determinable.
      idoc_input_matmas02_e.
      idoc_input_matmas03_e
        IMPORTING
          iv_lgnum    TYPE /scwm/lgnum DEFAULT ziot_constants=>lgnum
          iv_entitled TYPE /scwm/de_entitled DEFAULT ziot_constants=>entitled
        RAISING
          zcx_cp_not_readable
          zcx_plc_not_determinable.
    CLASS-METHODS create_job.
    CLASS-METHODS 
    det_relevant_products
      RETURNING
        VALUE(rt_products) TYPE /sapapo/matkey_out_tab.
    CLASS-METHODS conv_apo_matkey_to_whsprod
      IMPORTING
        !it_products       TYPE /sapapo/matkey_out_tab
      RETURNING
        VALUE(rt_products) TYPE /scwm/tt_material_lgnum_maint.
    CLASS-METHODS create_whs_products
      IMPORTING
        !it_products TYPE /scwm/tt_material_lgnum_maint.
    CLASS-METHODS: lock_products
      IMPORTING
        !it_products TYPE /scwm/tt_material_lgnum_maint.
    dequeue_all
      RAISING
        zcx_cp_not_readable
        zcx_plc_not_determinable.CLASS-METHODS CLASS-METHODS CLASS-METHODS CLASS-METHODS CLASS-METHODS CLASS-METHODS CLASS-METHODS CLASS-METHODS CLASS-METHODS CLASS-METHODS 
    CLASS-METHODS: 
      execute
        IMPORTING
          iv_lgnum    TYPE /scwm/lgnum DEFAULT ziot_constants=>lgnum
          iv_entitled TYPE /scwm/de_entitled DEFAULT ziot_constants=>entitled
        RAISING
          zcx_cp_not_readable
          zcx_plc_not_determinable.
      idoc_input_matmas01_e
        IMPORTING
          iv_lgnum    TYPE /scwm/lgnum DEFAULT ziot_constants=>lgnum
          iv_entitled TYPE /scwm/de_entitled DEFAULT ziot_constants=>entitled
        RAISING
          zcx_cp_not_readable
          zcx_plc_not_determinable.
      idoc_input_matmas02_e.
      idoc_input_matmas03_e
        IMPORTING
          iv_lgnum    TYPE /scwm/lgnum DEFAULT ziot_constants=>lgnum
          iv_entitled TYPE /scwm/de_entitled DEFAULT ziot_constants=>entitled
        RAISING
          zcx_cp_not_readable
          zcx_plc_not_determinable.
    CLASS-METHODS create_job.
    CLASS-METHODS 
    det_relevant_products
      RETURNING
        VALUE(rt_products) TYPE /sapapo/matkey_out_tab.
    CLASS-METHODS conv_apo_matkey_to_whsprod
      IMPORTING
        !it_products       TYPE /sapapo/matkey_out_tab
      RETURNING
        VALUE(rt_products) TYPE /scwm/tt_material_lgnum_maint.
    CLASS-METHODS create_whs_products
      IMPORTING
        !it_products TYPE /scwm/tt_material_lgnum_maint.
    CLASS-METHODS: lock_products
      IMPORTING
        !it_products TYPE /scwm/tt_material_lgnum_maint.
    dequeue_all
      RAISING
        zcx_cp_not_readable
        zcx_plc_not_determinable.CLASS-METHODS CLASS-METHODS CLASS-METHODS CLASS-METHODS CLASS-METHODS CLASS-METHODS CLASS-METHODS CLASS-METHODS CLASS-METHODS CLASS-METHODS 
    CLASS-METHODS: 
      execute
        IMPORTING
          iv_lgnum    TYPE /scwm/lgnum DEFAULT ziot_constants=>lgnum
          iv_entitled TYPE /scwm/de_entitled DEFAULT ziot_constants=>entitled
        RAISING
          zcx_cp_not_readable
          zcx_plc_not_determinable.
      idoc_input_matmas01_e
        IMPORTING
          iv_lgnum    TYPE /scwm/lgnum DEFAULT ziot_constants=>lgnum
          iv_entitled TYPE /scwm/de_entitled DEFAULT ziot_constants=>entitled
        RAISING
          zcx_cp_not_readable
          zcx_plc_not_determinable.
      idoc_input_matmas02_e.
      idoc_input_matmas03_e
        IMPORTING
          iv_lgnum    TYPE /scwm/lgnum DEFAULT ziot_constants=>lgnum
          iv_entitled TYPE /scwm/de_entitled DEFAULT ziot_constants=>entitled
        RAISING
          zcx_cp_not_readable
          zcx_plc_not_determinable.
    CLASS-METHODS create_job.
    CLASS-METHODS 
    det_relevant_products
      RETURNING
        VALUE(rt_products) TYPE /sapapo/matkey_out_tab.
    CLASS-METHODS conv_apo_matkey_to_whsprod
      IMPORTING
        !it_products       TYPE /sapapo/matkey_out_tab
      RETURNING
        VALUE(rt_products) TYPE /scwm/tt_material_lgnum_maint.
    CLASS-METHODS create_whs_products
      IMPORTING
        !it_products TYPE /scwm/tt_material_lgnum_maint.
    CLASS-METHODS: lock_products
      IMPORTING
        !it_products TYPE /scwm/tt_material_lgnum_maint.
    dequeue_all
      RAISING
        zcx_cp_not_readable
        zcx_plc_not_determinable.

  PROTECTED SECTION.
  PRIVATE SECTION.
    CLASS-DATA: mv_lgnum    TYPE /scwm/lgnum VALUE ziot_constants=>lgnum,
                mv_entitled TYPE /scwm/de_entitled VALUE ziot_constants=>entitled,
                mv_msg      TYPE string.
CLASS-METHODS CLASS-METHODS CLASS-METHODS CLASS-METHODS CLASS-METHODS CLASS-METHODS CLASS-METHODS CLASS-METHODS CLASS-METHODS CLASS-METHODS 
    CLASS-METHODS: 
      execute
        IMPORTING
          iv_lgnum    TYPE /scwm/lgnum DEFAULT ziot_constants=>lgnum
          iv_entitled TYPE /scwm/de_entitled DEFAULT ziot_constants=>entitled
        RAISING
          zcx_cp_not_readable
          zcx_plc_not_determinable.
      idoc_input_matmas01_e
        IMPORTING
          iv_lgnum    TYPE /scwm/lgnum DEFAULT ziot_constants=>lgnum
          iv_entitled TYPE /scwm/de_entitled DEFAULT ziot_constants=>entitled
        RAISING
          zcx_cp_not_readable
          zcx_plc_not_determinable.
      idoc_input_matmas02_e.
      idoc_input_matmas03_e
        IMPORTING
          iv_lgnum    TYPE /scwm/lgnum DEFAULT ziot_constants=>lgnum
          iv_entitled TYPE /scwm/de_entitled DEFAULT ziot_constants=>entitled
        RAISING
          zcx_cp_not_readable
          zcx_plc_not_determinable.
    CLASS-METHODS create_job.
    CLASS-METHODS 
    det_relevant_products
      RETURNING
        VALUE(rt_products) TYPE /sapapo/matkey_out_tab.
    CLASS-METHODS conv_apo_matkey_to_whsprod
      IMPORTING
        !it_products       TYPE /sapapo/matkey_out_tab
      RETURNING
        VALUE(rt_products) TYPE /scwm/tt_material_lgnum_maint.
    CLASS-METHODS create_whs_products
      IMPORTING
        !it_products TYPE /scwm/tt_material_lgnum_maint.
    CLASS-METHODS: lock_products
      IMPORTING
        !it_products TYPE /scwm/tt_material_lgnum_maint.
    dequeue_all
      RAISING
        zcx_cp_not_readable
        zcx_plc_not_determinable.CLASS-METHODS CLASS-METHODS CLASS-METHODS CLASS-METHODS CLASS-METHODS CLASS-METHODS CLASS-METHODS CLASS-METHODS CLASS-METHODS CLASS-METHODS 
    CLASS-METHODS: 
      execute
        IMPORTING
          iv_lgnum    TYPE /scwm/lgnum DEFAULT ziot_constants=>lgnum
          iv_entitled TYPE /scwm/de_entitled DEFAULT ziot_constants=>entitled
        RAISING
          zcx_cp_not_readable
          zcx_plc_not_determinable.
      idoc_input_matmas01_e
        IMPORTING
          iv_lgnum    TYPE /scwm/lgnum DEFAULT ziot_constants=>lgnum
          iv_entitled TYPE /scwm/de_entitled DEFAULT ziot_constants=>entitled
        RAISING
          zcx_cp_not_readable
          zcx_plc_not_determinable.
      idoc_input_matmas02_e.
      idoc_input_matmas03_e
        IMPORTING
          iv_lgnum    TYPE /scwm/lgnum DEFAULT ziot_constants=>lgnum
          iv_entitled TYPE /scwm/de_entitled DEFAULT ziot_constants=>entitled
        RAISING
          zcx_cp_not_readable
          zcx_plc_not_determinable.
    CLASS-METHODS create_job.
    CLASS-METHODS 
    det_relevant_products
      RETURNING
        VALUE(rt_products) TYPE /sapapo/matkey_out_tab.
    CLASS-METHODS conv_apo_matkey_to_whsprod
      IMPORTING
        !it_products       TYPE /sapapo/matkey_out_tab
      RETURNING
        VALUE(rt_products) TYPE /scwm/tt_material_lgnum_maint.
    CLASS-METHODS create_whs_products
      IMPORTING
        !it_products TYPE /scwm/tt_material_lgnum_maint.
    CLASS-METHODS: lock_products
      IMPORTING
        !it_products TYPE /scwm/tt_material_lgnum_maint.
    dequeue_all
      RAISING
        zcx_cp_not_readable
        zcx_plc_not_determinable.CLASS-METHODS CLASS-METHODS CLASS-METHODS CLASS-METHODS CLASS-METHODS CLASS-METHODS CLASS-METHODS CLASS-METHODS CLASS-METHODS CLASS-METHODS 
    CLASS-METHODS: 
      execute
        IMPORTING
          iv_lgnum    TYPE /scwm/lgnum DEFAULT ziot_constants=>lgnum
          iv_entitled TYPE /scwm/de_entitled DEFAULT ziot_constants=>entitled
        RAISING
          zcx_cp_not_readable
          zcx_plc_not_determinable.
      idoc_input_matmas01_e
        IMPORTING
          iv_lgnum    TYPE /scwm/lgnum DEFAULT ziot_constants=>lgnum
          iv_entitled TYPE /scwm/de_entitled DEFAULT ziot_constants=>entitled
        RAISING
          zcx_cp_not_readable
          zcx_plc_not_determinable.
      idoc_input_matmas02_e.
      idoc_input_matmas03_e
        IMPORTING
          iv_lgnum    TYPE /scwm/lgnum DEFAULT ziot_constants=>lgnum
          iv_entitled TYPE /scwm/de_entitled DEFAULT ziot_constants=>entitled
        RAISING
          zcx_cp_not_readable
          zcx_plc_not_determinable.
    CLASS-METHODS create_job.
    CLASS-METHODS 
    det_relevant_products
      RETURNING
        VALUE(rt_products) TYPE /sapapo/matkey_out_tab.
    CLASS-METHODS conv_apo_matkey_to_whsprod
      IMPORTING
        !it_products       TYPE /sapapo/matkey_out_tab
      RETURNING
        VALUE(rt_products) TYPE /scwm/tt_material_lgnum_maint.
    CLASS-METHODS create_whs_products
      IMPORTING
        !it_products TYPE /scwm/tt_material_lgnum_maint.
    CLASS-METHODS: lock_products
      IMPORTING
        !it_products TYPE /scwm/tt_material_lgnum_maint.
    dequeue_all
      RAISING
        zcx_cp_not_readable
        zcx_plc_not_determinable.CLASS-METHODS CLASS-METHODS CLASS-METHODS CLASS-METHODS CLASS-METHODS CLASS-METHODS CLASS-METHODS CLASS-METHODS CLASS-METHODS CLASS-METHODS 
    CLASS-METHODS: 
      execute
        IMPORTING
          iv_lgnum    TYPE /scwm/lgnum DEFAULT ziot_constants=>lgnum
          iv_entitled TYPE /scwm/de_entitled DEFAULT ziot_constants=>entitled
        RAISING
          zcx_cp_not_readable
          zcx_plc_not_determinable.
      idoc_input_matmas01_e
        IMPORTING
          iv_lgnum    TYPE /scwm/lgnum DEFAULT ziot_constants=>lgnum
          iv_entitled TYPE /scwm/de_entitled DEFAULT ziot_constants=>entitled
        RAISING
          zcx_cp_not_readable
          zcx_plc_not_determinable.
      idoc_input_matmas02_e.
      idoc_input_matmas03_e
        IMPORTING
          iv_lgnum    TYPE /scwm/lgnum DEFAULT ziot_constants=>lgnum
          iv_entitled TYPE /scwm/de_entitled DEFAULT ziot_constants=>entitled
        RAISING
          zcx_cp_not_readable
          zcx_plc_not_determinable.
    CLASS-METHODS create_job.
    CLASS-METHODS 
    det_relevant_products
      RETURNING
        VALUE(rt_products) TYPE /sapapo/matkey_out_tab.
    CLASS-METHODS conv_apo_matkey_to_whsprod
      IMPORTING
        !it_products       TYPE /sapapo/matkey_out_tab
      RETURNING
        VALUE(rt_products) TYPE /scwm/tt_material_lgnum_maint.
    CLASS-METHODS create_whs_products
      IMPORTING
        !it_products TYPE /scwm/tt_material_lgnum_maint.
    CLASS-METHODS: lock_products
      IMPORTING
        !it_products TYPE /scwm/tt_material_lgnum_maint.
    dequeue_all
      RAISING
        zcx_cp_not_readable
        zcx_plc_not_determinable.CLASS-METHODS CLASS-METHODS CLASS-METHODS CLASS-METHODS CLASS-METHODS CLASS-METHODS CLASS-METHODS CLASS-METHODS CLASS-METHODS CLASS-METHODS 
    CLASS-METHODS: 
      execute
        IMPORTING
          iv_lgnum    TYPE /scwm/lgnum DEFAULT ziot_constants=>lgnum
          iv_entitled TYPE /scwm/de_entitled DEFAULT ziot_constants=>entitled
        RAISING
          zcx_cp_not_readable
          zcx_plc_not_determinable.
      idoc_input_matmas01_e
        IMPORTING
          iv_lgnum    TYPE /scwm/lgnum DEFAULT ziot_constants=>lgnum
          iv_entitled TYPE /scwm/de_entitled DEFAULT ziot_constants=>entitled
        RAISING
          zcx_cp_not_readable
          zcx_plc_not_determinable.
      idoc_input_matmas02_e.
      idoc_input_matmas03_e
        IMPORTING
          iv_lgnum    TYPE /scwm/lgnum DEFAULT ziot_constants=>lgnum
          iv_entitled TYPE /scwm/de_entitled DEFAULT ziot_constants=>entitled
        RAISING
          zcx_cp_not_readable
          zcx_plc_not_determinable.
    CLASS-METHODS create_job.
    CLASS-METHODS 
    det_relevant_products
      RETURNING
        VALUE(rt_products) TYPE /sapapo/matkey_out_tab.
    CLASS-METHODS conv_apo_matkey_to_whsprod
      IMPORTING
        !it_products       TYPE /sapapo/matkey_out_tab
      RETURNING
        VALUE(rt_products) TYPE /scwm/tt_material_lgnum_maint.
    CLASS-METHODS create_whs_products
      IMPORTING
        !it_products TYPE /scwm/tt_material_lgnum_maint.
    CLASS-METHODS: lock_products
      IMPORTING
        !it_products TYPE /scwm/tt_material_lgnum_maint.
    dequeue_all
      RAISING
        zcx_cp_not_readable
        zcx_plc_not_determinable.

ENDCLASS.



CLASS ZIOT_CL_WHSPRD_CREATION IMPLEMENTATION.












  METHOD execute.

    mv_lgnum    = iv_lgnum.
    mv_entitled = iv_entitled.

    ziot_cl_log=>init( iv_subobject = ziot_constants=>log_subobject_whsprod_creation
                          iv_extnumber = TEXT-000 ).
    ziot_cl_log=>get_instance( )->log_caller( ).

    TRY.
        CALL METHOD ziot_cl_bs_general=>enqueue
          EXPORTING
            iv_exfunc = sy-repid.

        " Anzulegende Lagerprodukte ermitteln und entsprechende Daten vorbereiten
        DATA(lt_products) = det_relevant_products( ).

        DATA(lt_whs_products) = conv_apo_matkey_to_whsprod( lt_products ).

        create_whs_products( lt_whs_products ).

      CATCH cx_root.
    ENDTRY.

    dequeue_all( ).
    ziot_cl_log=>get_instance( )->save( ).

  ENDMETHOD.


  METHOD execute.

    mv_lgnum    = iv_lgnum.
    mv_entitled = iv_entitled.

    ziot_cl_log=>init( iv_subobject = ziot_constants=>log_subobject_whsprod_creation
                          iv_extnumber = TEXT-000 ).
    ziot_cl_log=>get_instance( )->log_caller( ).

    TRY.
        CALL METHOD ziot_cl_bs_general=>enqueue
          EXPORTING
            iv_exfunc = sy-repid.

        " Anzulegende Lagerprodukte ermitteln und entsprechende Daten vorbereiten
        DATA(lt_products) = det_relevant_products( ).

        DATA(lt_whs_products) = conv_apo_matkey_to_whsprod( lt_products ).

        create_whs_products( lt_whs_products ).

      CATCH cx_root.
    ENDTRY.

    dequeue_all( ).
    ziot_cl_log=>get_instance( )->save( ).

  ENDMETHOD.


  METHOD execute.

    mv_lgnum    = iv_lgnum.
    mv_entitled = iv_entitled.

    ziot_cl_log=>init( iv_subobject = ziot_constants=>log_subobject_whsprod_creation
                          iv_extnumber = TEXT-000 ).
    ziot_cl_log=>get_instance( )->log_caller( ).

    TRY.
        CALL METHOD ziot_cl_bs_general=>enqueue
          EXPORTING
            iv_exfunc = sy-repid.

        " Anzulegende Lagerprodukte ermitteln und entsprechende Daten vorbereiten
        DATA(lt_products) = det_relevant_products( ).

        DATA(lt_whs_products) = conv_apo_matkey_to_whsprod( lt_products ).

        create_whs_products( lt_whs_products ).

      CATCH cx_root.
    ENDTRY.

    dequeue_all( ).
    ziot_cl_log=>get_instance( )->save( ).

  ENDMETHOD.


  METHOD execute.

    mv_lgnum    = iv_lgnum.
    mv_entitled = iv_entitled.

    ziot_cl_log=>init( iv_subobject = ziot_constants=>log_subobject_whsprod_creation
                          iv_extnumber = TEXT-000 ).
    ziot_cl_log=>get_instance( )->log_caller( ).

    TRY.
        CALL METHOD ziot_cl_bs_general=>enqueue
          EXPORTING
            iv_exfunc = sy-repid.

        " Anzulegende Lagerprodukte ermitteln und entsprechende Daten vorbereiten
        DATA(lt_products) = det_relevant_products( ).

        DATA(lt_whs_products) = conv_apo_matkey_to_whsprod( lt_products ).

        create_whs_products( lt_whs_products ).

      CATCH cx_root.
    ENDTRY.

    dequeue_all( ).
    ziot_cl_log=>get_instance( )->save( ).

  ENDMETHOD.


  METHOD execute.

    mv_lgnum    = iv_lgnum.
    mv_entitled = iv_entitled.

    ziot_cl_log=>init( iv_subobject = ziot_constants=>log_subobject_whsprod_creation
                          iv_extnumber = TEXT-000 ).
    ziot_cl_log=>get_instance( )->log_caller( ).

    TRY.
        CALL METHOD ziot_cl_bs_general=>enqueue
          EXPORTING
            iv_exfunc = sy-repid.

        " Anzulegende Lagerprodukte ermitteln und entsprechende Daten vorbereiten
        DATA(lt_products) = det_relevant_products( ).

        DATA(lt_whs_products) = conv_apo_matkey_to_whsprod( lt_products ).

        create_whs_products( lt_whs_products ).

      CATCH cx_root.
    ENDTRY.

    dequeue_all( ).
    ziot_cl_log=>get_instance( )->save( ).

  ENDMETHOD.
  
ENDCLASS.